<?php
$account = $this->account;
$client = $this->account->getClient();
$client_html =  $client->getLastName() . ", " . $client->getFirstName();
$client_status_html = "Pending";
$payments = $account->getPayments();

$attrs = array(
  'firstPayDate',
  'amount', 
  'nPayments',
  'nPaid',
  'payPeriod',
  'status'
  );


$paymentAttrs = array(
  'Amount', 
  'Payment Number', 
  'Due Date', 
  'Paid Date',
  'Status'
  );


  ?>

  <h2> Account <?php echo $account->getAccountId(); ?> <small> <?php echo ucwords($client_html); ?></small> </h2>
  <div class='tabbable'>
    <ul class='nav nav-tabs'>
      <li class='active'><a href='#account_payments' data-toggle='tab'>Payments</a></li>
      <li><a href='#account_info' data-toggle='tab'> Informacion</a></li>
    </ul>

    <div class='tab-content'>

      
      <div class='tab-pane' id='account_info'>
        <div class="row-fluid"> 
          <div class="span2 offset1">
            <label class="control-label">
              <strong>Payments Start:</strong>
            </label>
          </div>
          <div class= "span9"> <label> <?php echo $account->getFirstPayDate(); ?> </label> </div> 
        </div>
        <div class="row-fluid"> 
          <div class="span2 offset1">
            <label class="control-label">
              <strong>Amount:</strong>
            </label>
          </div>
          <div class= "span9"> <label> <?php echo $account->getAmount(); ?> </label> </div> 
        </div>
        <div class="row-fluid"> 
          <div class="span2 offset1">
            <label class="control-label">
              <strong>Number of Payments:</strong>
            </label>
          </div>
          <div class= "span9"> <label> <?php echo $account->getNPayments(); ?> </label> </div> 
        </div>
        <div class="row-fluid"> 
          <div class="span2 offset1">
            <label class="control-label">
              <strong>Pay Period:</strong>
            </label>
          </div>
          <div class= "span9"> <label> <?php echo $account->getPayPeriod(); ?> </label> </div> 
        </div>
        <div class="row-fluid"> 
          <div class="span2 offset1">
            <label class="control-label">
              <strong>Number Paid:</strong>
            </label>
          </div>
          <div class= "span9"> <label> <?php echo $account->getNPaid(); ?> </label> </div> 
        </div>
        <div class="row-fluid"> 
          <div class="span2 offset1">
            <label class="control-label">
              <strong>Status:</strong>
            </label>
          </div>
          <div class= "span9"> <label> <?php echo $account->getStatus(); ?> </label> </div> 
        </div>
      </div>    

      <!-- Payments Tab Section -->

      <div class='tab-pane active' id='account_payments'>
        <?php 
          if ($account->getStatus() == \Account\Entity\Account::OPEN) {
            echo '<form action="/accounts/Account/pay" method="post">
            <input type="hidden" name="accountId" value="' . $account->getAccountId() . '"/>
            <input type="submit" class="btn" value="Hacer Un Pago"/>
          </form>';
          }
        ?>
        <table class='table'> 
          <thead>
            <tr>
              <?php
              if (count($payments) !== 0) {
                foreach($paymentAttrs as $attr ) {
                  echo "<th>" . $attr . "</th>";
                }
              }
              ?>
            </tr>
          </thead>
          <tbody>
            <?php
            foreach($payments as $tmp_payment) {
              echo "<tr>";
              ?>
              <td><?php echo $tmp_payment->getAmount(); ?></td>
              <td><?php echo $tmp_payment->getPaymentNumber(); ?></td>
              <td><?php echo $tmp_payment->getDueDateStr(); ?></td>
              <td><?php echo $tmp_payment->getPaidTimeStampStr(); ?></td>
              <td><?php echo $tmp_payment->getStatus(); ?></td>
              <?php
              echo "</tr>";
            }
            ?>
          </tbody>
        </table>
      </div>

      <!-- End Payments Tab Section -->


    </div>
  </div>

  <script>

  $("label span").each(function() {
    var $this = $(this);
    $this.replaceWith($("<label class='control-label'><strong>" + $this.html() + "</strong></label>"));
  });

  $("div label").each(function() {
    var $this = $(this);
    $this.replaceWith($("<div class='control-group'>" + $this.html() + "</div>"));
  });

  $('input').wrap('<div class="controls" />');

  </script>